<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace de Produtos Tecnológicos</title>
    <link rel="stylesheet" href="/view/styles.css">
</head>
<body>
    <header class="top-header">
        <!-- Conteúdo do header -->
    </header>

    <section class="products">
        <h2>Inserir Produto</h2>
        <form id="productForm">
            <input type="text" id="nome" placeholder="Nome do Produto" required>
            <input type="text" id="descricao" placeholder="Descrição do Produto">
            <input type="number" id="preco" placeholder="Preço" required>
            <input type="number" id="estoque" placeholder="Estoque" required>
            <button type="submit">Inserir Produto</button>
        </form>
        <h2>Buscar Produto</h2>
        <input type="text" id="searchInput" placeholder="Digite o nome do produto">
        <button onclick="searchProducts()">Buscar</button>
        <h2>Nossos Produtos</h2>
        <div class="product-grid" id="productGrid"></div>
    </section>

    <footer>
        <p>&copy; 2024 TechMarket - Todos os direitos reservados.</p>
    </footer>

    <script>
        // Função para buscar e exibir produtos
        async function fetchProducts() {
            try {
                const response = await fetch('http://localhost:3000/api/produtos');
                const products = await response.json();
                const productGrid = document.getElementById('productGrid');
                productGrid.innerHTML = '';

                products.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'product-item';
                    productItem.innerHTML = `
                        <h3>${product.nome}</h3>
                        <p>${product.descricao}</p>
                        <p>Preço: R$ ${product.preco.toFixed(2)}</p>
                        <p>Estoque: ${product.estoque}</p>
                    `;
                    productGrid.appendChild(productItem);
                });
            } catch (error) {
                console.error('Erro ao buscar produtos:', error);
            }
        }

        // Função para inserir um produto
        async function insertProduct(event) {
            event.preventDefault();

            const nome = document.getElementById('nome').value;
            const descricao = document.getElementById('descricao').value;
            const preco = document.getElementById('preco').value;
            const estoque = document.getElementById('estoque').value;

            try {
                const response = await fetch('http://localhost:3000/api/produtos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ nome, descricao, preco, estoque }),
                });

                if (response.ok) {
                    alert('Produto inserido com sucesso!');
                    document.getElementById('productForm').reset();
                    fetchProducts(); // Atualiza a lista de produtos
                } else {
                    alert('Erro ao inserir produto');
                }
            } catch (error) {
                console.error('Erro ao inserir produto:', error);
            }
        }

        // Event listener para o formulário
        document.getElementById('productForm').addEventListener('submit', insertProduct);

        // Buscar produtos ao carregar a página
        fetchProducts();
    </script>

    <script>
    // Função para buscar produtos com base no nome
    async function searchProducts() {
        const searchQuery = document.getElementById('searchInput').value; // Pega o valor do campo de busca

        try {
            // Faz a requisição GET com o nome do produto para buscar
            const response = await fetch(`http://localhost:3000/api/produtos/search?nome=${searchQuery}`);
            const products = await response.json();
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = ''; // Limpa a lista de produtos anterior

            if (products.length === 0) {
                productGrid.innerHTML = '<p>Nenhum produto encontrado.</p>'; // Mostra mensagem se não encontrar nada
            } else {
                // Percorre a lista de produtos e cria elementos HTML para exibi-los
                products.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'product-item';
                    productItem.innerHTML = `
                        <h3>${product.nome}</h3>
                        <p>${product.descricao}</p>
                        <p>Preço: R$ ${product.preco.toFixed(2)}</p>
                        <p>Estoque: ${product.estoque}</p>
                    `;
                    productGrid.appendChild(productItem);
                });
            }
        } catch (error) {
            console.error('Erro ao buscar produtos:', error);
        }
    }

    // Função para buscar e exibir todos os produtos ao carregar a página
    async function fetchProducts() {
        try {
            const response = await fetch('http://localhost:3000/api/produtos');
            const products = await response.json();
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = ''; // Limpa o grid de produtos

            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.innerHTML = `
                    <h3>${product.nome}</h3>
                    <p>${product.descricao}</p>
                    <p>Preço: R$ ${product.preco.toFixed(2)}</p>
                    <p>Estoque: ${product.estoque}</p>
                `;
                productGrid.appendChild(productItem);
            });
        } catch (error) {
            console.error('Erro ao buscar produtos:', error);
        }
    }

        // Função para buscar produtos com base no nome
        async function searchProducts() {
        const searchQuery = document.getElementById('searchInput').value; // Pega o valor do campo de busca

        try {
            // Faz a requisição GET com o nome do produto para buscar
            const response = await fetch(`http://localhost:3000/api/produtos/search?nome=${searchQuery}`);
            const products = await response.json();
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = ''; // Limpa a lista de produtos anterior

            if (products.length === 0) {
                productGrid.innerHTML = '<p>Nenhum produto encontrado.</p>'; // Mostra mensagem se não encontrar nada
            } else {
                // Percorre a lista de produtos e cria elementos HTML para exibi-los
                products.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'product-item';
                    productItem.innerHTML = `
                        <h3>${product.nome}</h3>
                        <p>${product.descricao}</p>
                        <p>Preço: R$ ${product.preco.toFixed(2)}</p>
                        <p>Estoque: ${product.estoque}</p>
                    `;
                    productGrid.appendChild(productItem);
                });
            }
        } catch (error) {
            console.error('Erro ao buscar produtos:', error);
        }
    }

    // Função para buscar e exibir todos os produtos ao carregar a página
    async function fetchProducts() {
        try {
            const response = await fetch('http://localhost:3000/api/produtos');
            const products = await response.json();
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = ''; // Limpa o grid de produtos

            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'product-item';
                productItem.innerHTML = `
                    <h3>${product.nome}</h3>
                    <p>${product.descricao}</p>
                    <p>Preço: R$ ${product.preco.toFixed(2)}</p>
                    <p>Estoque: ${product.estoque}</p>
                `;
                productGrid.appendChild(productItem);
            });
        } catch (error) {
            console.error('Erro ao buscar produtos:', error);
        }
    }

    // Busca todos os produtos ao carregar a página
    fetchProducts();
</script>

</body>
</html>
